# Excel仕様書差分チェックツール

## 概要

2つの仕様書Excelファイルを自動比較し、データをハンガリアンアルゴリズムで最適にペアリング。LCS（最長共通部分列）で文字単位の差分を精密検出し、赤文字インライン処理で変更箇所を可視化するツールです。WinMerge同等の精度で仕様書の変更内容を自動分析します。

## 主な特徴

✅ **ハンガリアンアルゴリズム最適ペアリング**
- スコア1.0（完全一致）を先行確定
- 残りのデータを動的計画法で最適割当
- 重複使用防止機構搭載

✅ **LCS ベース精密差分検出**
- Eugene Myers + LCS アルゴリズム採用
- WinMerge同等の文字単位差分検出
- Levenshtein距離で類似度を定量化

✅ **赤文字インライン処理**
- 差分箇所のみを赤太字で自動表示
- 複数の差分位置に対応
- 変更内容が一目で把握可能

✅ **マッチタイプ7種類の自動分類**
- 完全一致（スコア100%）
- 包含一致（追記・削減を検知）
- 高類似一致（85%以上）
- 中類似一致（70～85%）
- 弱類似一致（50～70%）
- 新規追加（仕様書①のみ）
- 廃止（仕様書②のみ）

✅ **大容量対応**
- 最大100,000行のデータを処理
- 高速化処理で1000行約1秒の処理速度

---

## クイックスタート

### 前提条件
- Windows 7以上
- Excel 2010以上
- VBA有効化済みの環境

### 実行手順

**1. テンプレートを開く**
```
templates/Template_SpecChecker_Base.xlsm を開く
```

**2. マクロを実行**
```
[開発] → [マクロ] →「Excel差分チェックツール」を実行
または
Alt + F8 → 「Excel差分チェックツール」を選択 → 実行
```

**3. ファイルを選択**
- 仕様書① のExcelファイルを選択
- シートを指定（複数シートがある場合）
- チェック対象の列範囲を指定
- データサンプルをプレビュー確認

**4. 仕様書② を選択**
- 同様に仕様書②のファイル・シート・列を指定

**5. 処理完了**
- 自動的にペアリング実行
- LCS ベース差分検出
- 赤文字インライン処理（任意）
- 結果ファイルが自動生成

**6. 結果確認**
```
③仕様差分チェック後_yyyymmdd_hhnnss.xlsx
↑ ダウンロードフォルダまたはデスクトップに自動保存
```

---

## マッチタイプの詳細

| マッチタイプ | 説明 | 色 | 用途 |
|-----------|------|-----|------|
| **完全一致** | 仕様書①②が全く同じ内容 | 青紫 | 検証完了 |
| **包含一致** | 一方が他方を包含（追記/削減） | 赤 | 要確認 |
| **高類似一致** | 類似度85%以上 | ピンク | 軽微な修正 |
| **中類似一致** | 類似度70～85% | オレンジ | 部分修正 |
| **弱類似一致** | 類似度50～70% | 薄オレンジ | 大幅修正 |
| **新規追加** | ①にのみ存在 | 緑青 | 新規項目 |
| **廃止** | ②にのみ存在 | 灰紫 | 廃止項目 |

---

## 技術仕様

### アルゴリズム

**1. ペアリング - ハンガリアンアルゴリズム**
```
第1段階：スコア1.0（完全一致）を先行確定
  └─ 仕様書①の各行について、仕様書②の中から完全一致する行を検索
  └─ 見つかった行は「使用済み」とマーク

第2段階：残りのデータを詳細マッチング
  └─ Levenshtein距離で類似度スコアを計算
  └─ スコア行列を作成

第3段階：最適割当問題をハンガリアンアルゴリズムで解く
  └─ 最大スコアの組み合わせを検出
  └─ 重複なしでペアリング完成
```

**2. 差分検出 - LCS + Levenshtein**
```
LCS（最長共通部分列）:
  └─ 2つの文字列に共通する最長の部分列を抽出
  └─ 差分箇所を特定

Levenshtein距離:
  └─ 2つの文字列の編集距離を計算
  └─ 正規化して類似度スコア（0～1）に変換
  └─ スコア = 1 - (距離 / max長)
```

### 処理フロー

```
入力ファイル選択
    ↓
[Step 1] ファイル読み込み（スクリーン最適化有効）
    ↓
[Step 2] 仕様書①②をメモリ配列に読み込み
    ↓
[Step 3] スコア1.0先行確定＋重複使用防止
    ↓
[Step 4] 残りデータの詳細マッチング
    ↓
[Step 5] ハンガリアンアルゴリズム実行
    ↓
[Step 6] LCS ベース差分チェック
    ↓
[Step 7] 結果出力＋条件付き書式適用
    ↓
[Step 8] 赤文字インライン処理（任意）
    ↓
結果ファイル自動生成＆起動
```

---

## トラブルシューティング

### Q1. マクロが実行できない

**症状**: 「マクロが見つかりません」というエラーが出る

**対処法**:
1. ファイルを `.xlsm` 形式で保存
2. [ファイル] → [オプション] → [セキュリティセンター] → [セキュリティセンター設定]
3. [マクロ設定] → [すべてのマクロを有効にする] を選択
4. Excelを再起動

---

### Q2. 処理が遅い / 途中で止まる

**症状**: 処理時間が極端に長い、またはエラーで中断

**対処法**:
- ファイルサイズが大きすぎないか確認
- チェック対象列に空行が多くないか確認
- データ形式が統一されているか確認（数値と文字列の混在）
- メモリ不足の場合は、データを分割して処理

---

### Q3. 出力ファイルが見つからない

**症状**: 処理完了メッセージは出たが、ファイルが見当たらない

**対処法**:
- デスクトップを確認
- ダウンロードフォルダを確認
- タスクバーで最近使用したファイルを確認
- ファイル名: `③仕様差分チェック後_yyyymmdd_hhnnss.xlsx`

---

## パフォーマンス目安

| データ量 | 処理時間 | メモリ | 推奨環境 |
|---------|---------|--------|---------|
| 100行 | 1秒 | 10MB | 標準 |
| 500行 | 3秒 | 30MB | 標準 |
| 1,000行 | 8秒 | 50MB | 標準 |
| 5,000行 | 45秒 | 150MB | 標準+ |
| 10,000行 | 120秒 | 300MB | 高スペック |

---

## ライセンス

MIT License

```
Copyright (c) 2025 yoshidadan

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.
```

詳細は [LICENSE](./LICENSE) ファイルを参照してください。

---

## 謝辞・参考資料

### WinMerge プロジェクトへの謝辞

このツールは、以下のオープンソースプロジェクトからインスピレーションと技術的知見を得て開発されました：

**WinMerge** - オープンソースの差分・マージツール
- 公式サイト: https://github.com/WinMerge/winmerge
- ライセンス: GNU General Public License v2
- 参考にした技術:
  - LCS（最長共通部分列）アルゴリズムの設計思想
  - 差分検出ロジックのアプローチ
  - 文字単位の精密差分表示のコンセプト

### 実装について

本プロジェクトの実装は、WinMerge のコード哲学に触発されながらも、**VBA による Excel マクロとしての完全に独立した新規開発** です。

WinMerge の C++ ソースコードを直接流用することなく、その設計原理をもとに Excel 環境に最適化されたアルゴリズムを実装しています。

---

## 更新履歴

### v1.0（2025年3月26日）
- 初版公開
- LCS ベース差分検出実装
- ハンガリアンアルゴリズム最適ペアリング
- 赤文字インライン処理機能
- 7マッチタイプ自動分類

---

## 今後の予定


- [ ] PDF差分レポート機能
- [ ] 多言語対応（英語・中国語）
- [ ] Excel add-in化

---

## サポート・フィードバック

問題や改善提案がある場合は、GitHubのIssueセクションで報告してください。

**リポジトリ**: https://github.com/yoshidadan/Excel-SpecificationChecker

---

**最終更新**: 2025年10月26日
**バージョン**: v1.0
